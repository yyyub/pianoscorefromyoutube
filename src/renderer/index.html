<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
  <title>YouTube to Piano Sheet Music</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>🎹 YouTube to Piano Sheet Music</h1>
      <p class="subtitle">AI로 YouTube 영상을 피아노 악보로 변환</p>
    </header>

    <main>
      <div class="input-section">
        <div class="input-group">
          <label for="youtube-url">YouTube URL</label>
          <input
            type="text"
            id="youtube-url"
            placeholder="https://www.youtube.com/watch?v=..."
            autocomplete="off"
          >
          <span class="error-message" id="url-error"></span>
        </div>

        <div class="advisor-card">
          <div class="advisor-header">
            <h3>변환 가이드</h3>
            <p>곡 유형과 목표를 선택하면 권장 설정을 자동으로 맞춥니다.</p>
          </div>
          <div class="advisor-grid">
            <label class="advisor-field">
              <span>입력 곡 유형</span>
              <select id="source-type">
                <option value="piano-cover" selected>피아노 커버</option>
                <option value="original">원곡(보컬/밴드)</option>
                <option value="unknown">잘 모르겠음</option>
              </select>
            </label>
            <label class="advisor-field">
              <span>변환 목표</span>
              <select id="target-priority">
                <option value="accuracy" selected>원곡 유사도 우선</option>
                <option value="balanced">균형(정확도/난이도)</option>
                <option value="speed">빠른 초안 우선</option>
              </select>
            </label>
          </div>
          <div class="issue-row">
            <label class="option-row">
              <input type="checkbox" id="issue-offbeat">
              엇박/리듬 깨짐이 심함
            </label>
            <label class="option-row">
              <input type="checkbox" id="issue-wrong-notes">
              이상한 음(잡음성 노트)이 많음
            </label>
          </div>
          <div class="advisor-actions">
            <button id="apply-recommended-btn" class="btn btn-secondary" type="button">권장 설정 적용</button>
            <div id="setting-summary" class="setting-summary"></div>
          </div>
          <div id="recommendation-text" class="recommendation-text"></div>
        </div>

        <div class="button-group">
          <button id="start-btn" class="btn btn-primary">
            변환 시작
          </button>
          <button id="cancel-btn" class="btn btn-secondary" disabled>
            취소
          </button>
        </div>

        <div class="option-group">
          <label class="option-row">
            <input type="checkbox" id="use-separation" checked>
            음원 분리 (Demucs AI) - 보컬/반주 분리로 품질 향상
          </label>
          <label class="option-row">
            난이도:
            <select id="quality-mode">
              <option value="beginner">초급 (쉬운 악보)</option>
              <option value="intermediate" selected>중급 (적당한 난이도)</option>
              <option value="advanced">고급 (원곡에 가까움)</option>
            </select>
          </label>
        </div>
      </div>

      <div class="history-section" id="history-section">
        <div class="history-header">
          <h3>변환 기록</h3>
        </div>
        <div class="history-list" id="history-list">
          <div class="history-empty">변환 기록이 없습니다.</div>
        </div>
      </div>

      <div class="progress-section" id="progress-section">
        <div class="progress-steps">
          <div class="progress-step" data-step="1">
            <div class="step-icon">1</div>
            <div class="step-label">다운로드</div>
            <div class="step-status">대기 중</div>
          </div>
          <div class="progress-step" data-step="2">
            <div class="step-icon">2</div>
            <div class="step-label">변환</div>
            <div class="step-status">대기 중</div>
          </div>
          <div class="progress-step" data-step="3">
            <div class="step-icon">3</div>
            <div class="step-label">전사</div>
            <div class="step-status">대기 중</div>
          </div>
          <div class="progress-step" data-step="4">
            <div class="step-icon">4</div>
            <div class="step-label">MIDI 저장</div>
            <div class="step-status">대기 중</div>
          </div>
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-info">
          <div class="progress-text" id="progress-text">준비 완료</div>
          <div class="eta-text" id="eta-text"></div>
        </div>
      </div>

      <div class="log-section">
        <div class="log-header">
          <h3>처리 로그</h3>
          <button id="clear-log-btn" class="btn-icon">지우기</button>
        </div>
        <div class="log-container" id="log-container">
          <div class="log-message log-info">
            YouTube URL을 입력하고 '변환 시작' 버튼을 클릭하세요.
          </div>
        </div>
      </div>

      <div class="result-section" id="result-section">
        <div class="result-card">
          <h3>✅ 변환 완료!</h3>
          <p id="result-message">MIDI 파일이 생성되었습니다.</p>
          <button id="open-pdf-btn" class="btn btn-primary">MIDI 열기</button>
          <button id="open-folder-btn" class="btn btn-secondary">폴더 열기</button>
        </div>
      </div>
    </main>

    <footer>
      <p>
        FFmpeg 설치 필요 |
        <a href="#" id="help-link">도움말</a> |
        <a href="#" id="about-link">정보</a>
      </p>
    </footer>
  </div>

  <script src="scripts/app.js"></script>
  <script src="scripts/ui-controller.js"></script>
  <script src="scripts/progress-handler.js"></script>
</body>
</html>
